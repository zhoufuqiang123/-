<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>展示所有已标注图片</title>
    <script type="text/javascript" src="../static/js/vue.js"></script>
    <script type="text/javascript" src="../static/js/axios.min.js"></script>
</head>
<style>
    .k{
        font-size: 50px;
        clear: both;
    }
    .img{
        width: 150px;
        height: 200px;
        margin:15px ;
    }
    .input{
        height: 37px;
        width: 450px;
        font-size: 21px;
        color: gray;
    }
    .date_chaxun{
        width: 70px;
    }
    .imgs_son{
        /*width: 300px;*/
        margin: 5px;
        float: left;
    }
    .julei{

    }
    #root_title{
        text-align: center;
    }
    /*.span1 span{*/
    /*    position: absolute;*/
    /*    left: 10px;*/
    /*    top: 10px;*/
    /*}*/
    /*img{*/
    /*    left: 30px;*/
    /*    top: 30px;*/

    /*}*/
    /*.k{*/
    /*    position: relative;*/
    /*    left: 5px;*/

    /*}*/
</style>
<body>
<div id="root">
    <h2 id="root_title">所有已标注图片</h2>
    <br>
<!--    <input type="text" v-model="date_chaxun" placeholder="输入查询日期" class="date_chaxun">-->
<!--    <button @click="chaxun">查询</button>-->
<!--    <button @click="show_on_newpage">在新页面打开</button>-->
    <select name="" v-model="res_mark">
        <option value="">请选择人名</option>
        <option value="NULL">清除标注</option>
        <option  v-for="i in staffs" :value="i" >{{i}}</option>
    </select>
<!--    <button @click="show_single_man">按人名查询</button>-->
    <button @click="update_batch_mark">点击进行标注</button>
    <br>

        <span v-for="data in ai_data" class="imgs_son">
            <input type="checkbox" id="img_checkbox" v-model="img_checkbox" :value="[data[0],data[1]] | connect_name_time" >
            <img  :src="data[2]" alt="暂无图片" class="img" @click="update_result_mark(data[0],data[1])">


            <br>
            <span>{{data[0]}}{{data[1]}}</span>
            <br>
        </span>


</div>
<!--<img src="../static/img/1.jpeg" alt="">-->

</body>
<script>
    Vue.config.productionTip=false

    const vm = new Vue({
        el:'#root',
        data:{
            staffs:[],  //  人名
            images:[],
            toDir:'',
            num_clusters:null,
            res_date:'',
            res_mark:'',
            img_checkbox:[],  // 多选框收集人名_日期
            julei_date:'',
            ai_data:[], //  人名，日期，图片
            date_chaxun:JSON.parse(sessionStorage.getItem("date_chaxun")) ||'04-05', // 查询日期
            ai_data_single_man:[],
            is_chaxun:false,
        },
        methods:{
            update_batch_mark_f1(){
                return axios({
                        url: 'http://10.20.14.27:80/update_batch_mark',
                        method: 'post',
                        responseType: 'json', // 默认的
                        data: {
                            img_checkbox:this.img_checkbox,
                            res_mark:this.res_mark,
                            id:3
                        }
                 }).then(function (response) {
                    alert(response.data)
                    return response
                 }).catch(function (error) {
                    console.log(error);
                 });
            },
            update_batch_mark(){
                console.log(this.img_checkbox,'获取到img_checkbox')
                console.log(this.res_mark,'获取到res_mark')
                if(this.res_mark == ''){
                    alert('请选择人名')
                }else {
                    this.update_batch_mark_f1().then(res=>{
                        location.reload()
                    },rej=>{location.reload()})
                }
            },
            juLei(e){
                if (!this.num_clusters){
                    alert('请输入聚人物数量')
                }else if (this.num_clusters>this.staffs.length+5){
                    alert('请确认聚类人物数量是否正确')
                    console.log(this.staffs.length)
                }else if (!this.julei_date){
                    alert('请输入聚类日期')
                }else if(this.julei_date.length!==5){
                    alert('日期格式不对，正确格式样例：04-07')
                }else{
                    axios
                      .post('http://10.20.14.42:52400/kmeans_clustering',
                          {
                              num_clusters:this.num_clusters,
                              date_data:this.julei_date

                          })
                      .then(response => (console.log(response.data)))
                      .catch(function (error) { // 请求失败处理
                        console.log(error);
                      });
                }
                // location.reload();
                // this.toDir=''
            },
            chaxun(e){
                axios
                  .get('http://10.20.14.27:80/get_ai_data'+'/'+this.date_chaxun)
                  .then(response => (
                      this.img_checkbox=[],
                      this.ai_data=response.data.ai_data,
                      console.log(this.ai_data)
                  ))
                  .catch(function (error) { // 请求失败处理
                   console.log(error);
                  });
                // location.reload();
                // this.toDir=''
            },
            show_on_newpage(){
                window.open('/test_sql_img'+'/'+this.date_chaxun)
            },
            show_single_man_f1(){
                axios
                  .get('http://10.20.14.27:80/get_ai_data'+'/'+this.date_chaxun)
                  .then(response => (
                      this.ai_data=response.data.ai_data,
                      console.log('函数f1请求得到的this.ai_data：',this.ai_data)
                  ))
                  .catch(function (error) { // 请求失败处理
                   console.log(error);
                  });
                this.is_chaxun = !this.is_chaxun
            },
            show_single_man_f2(){
                this.ai_data_single_man=[]
                if(this.ai_data&&this.res_mark){
                    for (i in this.ai_data){
                        // console.log(this.ai_data[i][0])
                        // console.log('需要筛选的人名',this.res_mark)
                        if (this.ai_data[i][0]==this.res_mark){
                            this.ai_data_single_man.push(this.ai_data[i])
                            console.log('添加了照片信息：',this.ai_data[i])
                        }
                    }
                    this.ai_data = this.ai_data_single_man
                    console.log('筛选信息',this.ai_data_single_man)
                }
                console.log('数据是:',this.ai_data)
            },
            sleep(time){
                return new Promise((resolve) => setTimeout(resolve, time));
            },
            show_single_man(){
                a =this.show_single_man_f1
                b = this.show_single_man_f2
                c = this.sleep
                async  function start() {
                    await a();
                    await c(3000)
                    await b();
                }
                start()
                // this.show_single_man_f1()
                // this.is_chaxun = !this.is_chaxun
            },
        },
		watch: {
			date_chaxun: {
				// deep: true,
				handler(news, olds) {
					sessionStorage.setItem("date_chaxun", JSON.stringify(news))
				}
			}
		},
        mounted () {
            // if (!this.res_date){
            //     this.res_date = '04-05'
            // }
            axios
              .get('http://10.20.14.27:80/select_all_status_name')
              .then(response => (this.staffs=response.data.list_status))
              .catch(function (error) { // 请求失败处理
               console.log(error);
              });
            // axios
            //   .get('http://10.20.14.27:80/getStaffs1')
            //   .then(response => (this.images=response.data))test3_db.html
            //   .catch(function (error) { // 请求失败处理
            //     console.log(error);
            //   });
            axios
              .get('http://10.20.14.27:80/get_all_marked_data')
              .then(response => (
                  this.ai_data=response.data.ai_data,
                  console.log(this.ai_data)
              ))
              .catch(function (error) { // 请求失败处理
               console.log(error);
              });
        },
        filters:{
            mySlice(value){
                console.log(value)
                value1 = value.split('/')[4]
                console.log(value1)
                value2 = value1.split('_')
                return value2[0]+'_'+value2[1].slice(0,2)+':'+value2[1].slice(2,4)+value2[2].split('.')[0]
            },
            connect_name_time(value){
                return value[0]+'_'+value[1]
            }

        }
    })
</script>
</html>